<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>活動公約上傳 | 北科大徵才活動</title>
</head>
<body style="font-family: Noto Sans TC; padding: 40px; max-width: 600px; margin: auto;">
  <h2>📎 活動公約上傳</h2>
  <form id="uploadForm">
    <label>統一編號：</label><br>
    <input type="text" id="id" name="id" required><br><br>

    <label>Email：</label><br>
    <input type="email" id="email" name="email" required><br><br>

    <label>PDF 檔案：</label><br>
    <input type="file" id="file" name="file" accept="application/pdf" required><br><br>

    <button type="submit">✅ 上傳 PDF</button>
  </form>

  <p id="result" style="margin-top: 24px; color: #2b4;"> </p>

  <script>
    const params = new URLSearchParams(location.search);
    if (params.get("id")) document.getElementById("id").value = params.get("id");
    if (params.get("email")) document.getElementById("email").value = params.get("email");

    document.getElementById("uploadForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const id = document.getElementById("id").value.trim();
      const email = document.getElementById("email").value.trim();
      const file = document.getElementById("file").files[0];

      if (!file || !file.type.includes("pdf")) {
        document.getElementById("result").innerText = "❌ 請上傳 PDF 檔案";
        return;
      }

      const reader = new FileReader();
      reader.onload = async function () {
        const base64 = reader.result.split(",")[1];

        const formData = new URLSearchParams();
        formData.append("id", id);
        formData.append("email", email);
        formData.append("filename", file.name);
        formData.append("data", base64);

        const response = await fetch("https://script.google.com/macros/s/AKfycbwykjEgNadi5xRaOkmHnq8QNXSpwySeoG1y_cOcSjPVVVDpC4ZznaKN_N9qiiDNY9IA2A/exec", {
          method: "POST",
          body: formData
        });

        const resultText = await response.text();
        document.getElementById("result").innerText = resultText;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
